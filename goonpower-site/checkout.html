<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout | GOON Power</title>
  <style>
    :root{ --bg:#0B0B0B; --fg:#F5F5F5; --muted:#DDDDDD; --olive:#4B5320; --accent:#B22222; --accent-dark:#8B1A1A; --card:#1e1e1e; --border:#2d2d2d; }
    *{box-sizing:border-box} body{margin:0;font-family:'Arial Black',sans-serif;background:var(--bg);color:var(--fg)}
    .compact-header{background:#0B0B0B;padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between;border-bottom:2px solid var(--olive)}
    .logo-nav{display:flex;align-items:center;gap:2rem;width:100%;justify-content:space-between}
    .logo-nav img{height:60px}
    nav{display:flex;gap:1.25rem;flex-wrap:wrap;align-items:center}
    nav a{color:#F5F5F5;font-weight:bold;text-decoration:none;font-size:1rem;transition:color .3s;position:relative}
    nav a:hover{color:var(--accent)}
    .badge{position:absolute;top:-10px;right:-12px;background:var(--accent);color:#fff;font-size:.72rem;font-weight:900;border-radius:999px;padding:.05rem .4rem;min-width:1.2rem;text-align:center}

    .wrap{max-width:1100px;margin:0 auto;padding:2rem 1rem}
    h1{margin:0 0 .35rem;color:var(--accent)}
    .sub{color:var(--muted);margin:0 0 1.25rem}
    .back{display:inline-flex;align-items:center;gap:.4rem;color:#bbb;text-decoration:none;margin-bottom:.75rem}
    .back:hover{color:#fff}

    .grid{display:grid;grid-template-columns:2fr 1fr;gap:1.25rem}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1rem}
    .card h2{font-size:1.1rem;margin:.25rem 0 .75rem;color:#fff}
    label{display:block;font-size:.95rem;margin:.4rem 0 .25rem}
    input,select,textarea{width:100%;padding:.7rem;border-radius:8px;border:1px solid #3a3a3a;background:#121212;color:#fff}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}

    .pmethods{display:flex;flex-wrap:wrap;gap:.5rem;margin:.25rem 0 1rem}
    .pmethod{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border:1px solid var(--border);border-radius:999px;background:#141414;cursor:pointer}
    .pmethod input{accent-color:var(--accent)}
    .pmethod.active{border-color:var(--accent)}

    .hidden{display:none}
    .paybtn{width:100%;padding:1rem;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:900;cursor:pointer}
    .paybtn:disabled{opacity:.5;cursor:not-allowed}
    .paybtn:hover:not(:disabled){background:var(--accent-dark)}

    .order-summary ul{list-style:none;padding:0;margin:0}
    .order-summary li{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px dashed #333}
    .total{display:flex;justify-content:space-between;margin-top:.5rem;font-size:1rem;color:#ddd}
    .grand{display:flex;justify-content:space-between;margin-top:.6rem;font-size:1.15rem;color:var(--accent);border-top:1px solid #333;padding-top:.6rem}

    .note{font-size:.9rem;color:var(--muted);margin-top:.5rem}
    .error{border-color:#b74a4a !important; box-shadow:0 0 0 2px rgba(183,74,74,.25)}
    .hint{color:#bfbfbf;font-size:.85rem;margin-top:.25rem}

    .ship-methods{display:flex;flex-wrap:wrap;gap:.5rem;margin:.35rem 0 .25rem}
    .ship-methods label{display:inline-flex;align-items:center;gap:.5rem;background:#141414;border:1px solid var(--border);border-radius:999px;padding:.5rem .75rem;cursor:pointer}
    .ship-methods input{accent-color:var(--accent)}
    .coupon-row{display:flex;gap:.5rem;margin-top:.5rem}
    .coupon-row input{flex:1}
    .coupon-row button{padding:.7rem 1rem;border-radius:10px;border:1px solid var(--border);background:#141414;color:#fff;font-weight:900;cursor:pointer}
    .coupon-row button:hover{filter:brightness(.95)}

    .saveinfo{display:flex;align-items:center;gap:.5rem;margin-top:.5rem}
    .agree{display:flex;align-items:center;gap:.5rem;margin-top:.75rem}

    footer{margin-top:2rem;text-align:center;font-size:.9rem;color:#aaa;padding:1.5rem 1rem}

    @media (max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="compact-header">
    <div class="logo-nav">
      <img src="images/gpssbannercompact.png" alt="GOON Power Logo">
      <nav>
        <a href="index.html">Home</a>
        <a href="supps.html">Supplements</a>
        <a href="apparel.html">Apparel</a>
        <a href="faq.html">FAQ</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="cart.html" id="cartLink">Cart <span class="badge" id="cartBadge">0</span></a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <a class="back" href="cart.html">&#8592; Return to Cart</a>
    <h1>Secure Checkout</h1>
    <div class="sub">All payments are encrypted. Choose your method below.</div>

    <div class="grid">
      <!-- Left: Customer + Payment -->
      <div class="card">
        <h2>Customer & Shipping</h2>
        <div class="row">
          <div>
            <label for="first">First Name</label>
            <input id="first" autocomplete="shipping given-name" required />
          </div>
          <div>
            <label for="last">Last Name</label>
            <input id="last" autocomplete="shipping family-name" required />
          </div>
        </div>
        <label for="email">Email</label>
        <input id="email" type="email" autocomplete="email" required />
        <label for="phone">Phone <span class="hint">(optional)</span></label>
        <input id="phone" type="tel" autocomplete="tel" />

        <label for="address">Address</label>
        <input id="address" autocomplete="shipping address-line1" required />
        <div class="row">
          <div>
            <label for="city">City</label>
            <input id="city" autocomplete="address-level2" required />
          </div>
          <div>
            <label for="state">State</label>
            <input id="state" maxlength="2"  autocomplete="address-level1" required />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="zip">ZIP</label>
            <input id="zip" autocomplete="postal-code" required />
          </div>
          <div>
            <label for="country">Country</label>
            <select id="country">
              <option value="US">United States</option>
            </select>
          </div>
        </div>

        <div class="saveinfo">
          <input id="remember" type="checkbox" checked />
          <label for="remember" style="margin:0">Save my info for next time</label>
        </div>
      </div>

      <!-- Right: Order Summary -->
      <aside class="card order-summary">
        <h2>Order Summary</h2>
        <ul id="summary"></ul>

        <h3 style="margin:.75rem 0 .25rem">Shipping Method</h3>
        <div class="ship-methods">
          <label><input type="radio" name="ship" value="standard" checked>Standard (3–5 days) — $5.99</label>
          <label><input type="radio" name="ship" value="expedited">Expedited (2-day) — $12.99</label>
          <label id="freeShipLabel" class="hidden"><input type="radio" name="ship" value="free">Free (Orders $75+)</label>
        </div>

        <div class="coupon-row">
          <input id="coupon" placeholder="Promo code (e.g., BEAST10, VETERAN15, FREESHIP)" />
          <button id="applyCoupon" type="button">Apply</button>
        </div>
        <div class="note" id="couponMsg"></div>

        <div class="total"><span>Subtotal</span><strong id="subtotal">$0.00</strong></div>
        <div class="total" id="discountRow" style="display:none"><span>Discount</span><strong id="discount">-$0.00</strong></div>
        <div class="total"><span>Shipping</span><strong id="shipping">$0.00</strong></div>
        <div class="total"><span>Tax</span><strong id="tax">$0.00</strong></div>
        <div class="grand"><span>Total</span><strong id="grand">$0.00</strong></div>
        <div class="note">(Shipping & tax are placeholders.)</div>
      </aside>
    </div>

    <div class="card" style="margin-top:1rem">
      <h2>Payment Method</h2>
      <div class="pmethods" id="pmethods">
        <label class="pmethod"><input type="radio" name="pm" value="card" checked>Credit/Debit Card</label>
        <label class="pmethod"><input type="radio" name="pm" value="paypal">PayPal</label>
        <label class="pmethod"><input type="radio" name="pm" value="venmo">Venmo</label>
        <label class="pmethod"><input type="radio" name="pm" value="apple">Apple Pay</label>
        <label class="pmethod"><input type="radio" name="pm" value="google">Google Pay</label>
      </div>

      <!-- Card form -->
      <div id="pay-card">
        <div class="row">
          <div>
            <label for="cc-number">Card Number</label>
            <input id="cc-number" placeholder="4242 4242 4242 4242" inputmode="numeric" />
          </div>
          <div>
            <label for="cc-exp">Expiry (MM/YY)</label>
            <input id="cc-exp" placeholder="12/28" />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="cc-name">Name on Card</label>
            <input id="cc-name" />
          </div>
          <div>
            <label for="cc-cvc">CVC</label>
            <input id="cc-cvc" placeholder="123" />
          </div>
        </div>
        <label class="agree"><input type="checkbox" id="agree" /> I agree to the terms.</label>
        <button class="paybtn" id="btn-card" disabled>Pay with Card</button>
      </div>

      <!-- Express buttons (mock) -->
      <div id="pay-paypal" class="hidden"><button class="paybtn" id="btn-paypal">Pay with PayPal</button></div>
      <div id="pay-venmo" class="hidden"><button class="paybtn" id="btn-venmo">Pay with Venmo</button></div>
      <div id="pay-apple" class="hidden"><button class="paybtn" id="btn-apple">Pay with Apple Pay</button></div>
      <div id="pay-google" class="hidden"><button class="paybtn" id="btn-google">Pay with Google Pay</button></div>

      <div class="note">These are live-behavior mocks for layout and UX. We'll wire real gateways later.</div>
    </div>
  </div>

  <footer>&copy; 2025 GFPS, LLC | Veteran-Owned | Warren, OH</footer>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // ---- utils ----
      const $ = (id)=>document.getElementById(id);
      const fmt = n => `$${Number(n||0).toFixed(2)}`;
      const get = id => document.getElementById(id);
      const val = id => (get(id)?.value||'').toString().trim();

      // ---- Cart badge ----
      function updateCartBadge(){
        const cart = JSON.parse(localStorage.getItem('goonCart')||'[]');
        const badge = $('cartBadge'); if(badge) badge.textContent = cart.length;
      }
      updateCartBadge();
      window.addEventListener('storage', updateCartBadge);

      // ---- Load cart + totals ----
      const summary = $('summary');
      const subtotalEl = $('subtotal');
      const discountRow = $('discountRow');
      const discountEl = $('discount');
      const shippingEl = $('shipping');
      const taxEl = $('tax');
      const grandEl = $('grand');
      const couponMsg = $('couponMsg');

      let cart = [];
      let subtotal = 0;
      let discount = 0;
      let shippingCost = 0;
      let shipMethod = 'standard';
      let promo = '';

      function readCart(){
        cart = JSON.parse(localStorage.getItem('goonCart')) || [];
        summary.innerHTML = '';
        subtotal = 0;
        cart.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `<span>${item.name}${item.size?` (${item.size})`:''}</span><strong>${fmt(item.price)}</strong>`;
          subtotal += Number(item.price||0);
          summary.appendChild(li);
        });
      }

      // ---- Shipping methods ----
      const shipRadios = document.querySelectorAll('input[name="ship"]');
      const freeShipLabel = $('freeShipLabel');
      function refreshShippingUI(){
        // Free ship eligibility
        if(subtotal >= 75){
          freeShipLabel.classList.remove('hidden');
        } else {
          freeShipLabel.classList.add('hidden');
          if(shipMethod==='free') shipMethod = 'standard';
          document.querySelector('input[name="ship"][value="standard"]').checked = true;
        }
        // Set shippingCost
        if(shipMethod==='expedited') shippingCost = 12.99;
        else if(shipMethod==='free') shippingCost = 0;
        else shippingCost = cart.length ? 5.99 : 0;
      }
      shipRadios.forEach(r=>r.addEventListener('change', (e)=>{shipMethod=e.target.value; renderTotals();}));

      // ---- Promo codes ----
      function applyPromoCode(code){
        promo = code.toUpperCase();
        discount = 0;
        couponMsg.textContent='';
        if(promo==='BEAST10'){
          discount = +(subtotal * 0.10).toFixed(2);
          couponMsg.textContent='BEAST10 applied: 10% off subtotal.';
        } else if(promo==='VETERAN15'){
          discount = +(subtotal * 0.15).toFixed(2);
          couponMsg.textContent='VETERAN15 applied: 15% off subtotal.';
        } else if(promo==='FREESHIP'){
          shipMethod = 'free';
          discount = 0;
          couponMsg.textContent='FREESHIP applied: shipping set to $0.';
        } else if(promo){
          couponMsg.textContent='Invalid code.';
          promo='';
        }
      }
      $('applyCoupon').addEventListener('click', ()=>{ applyPromoCode(val('coupon')); renderTotals(); });

      // ---- Totals ----
      function renderTotals(){
        refreshShippingUI();
        const taxable = Math.max(0, subtotal - discount);
        const tax = +(taxable * 0.07).toFixed(2);
        const grand = Math.max(0, taxable + shippingCost + tax);
        subtotalEl.textContent = fmt(subtotal);
        if(discount>0){ discountRow.style.display='flex'; discountEl.textContent = '-' + fmt(discount).slice(1); }
        else { discountRow.style.display='none'; }
        shippingEl.textContent = fmt(shippingCost);
        taxEl.textContent = fmt(tax);
        grandEl.textContent = fmt(grand);
      }

      // ---- Prefill shipping (draft or last order) ----
      const reqIds = ['first','last','email','address','city','state','zip'];
      const allShipIds = [...reqIds, 'phone','country'];
      function loadDraft(){
        let src = localStorage.getItem('goonCheckoutDraft');
        if(!src){
          const last = localStorage.getItem('goonLastOrder');
          if(last){ src = JSON.stringify(JSON.parse(last).customer || {}); }
        }
        if(!src) return;
        try{
          const data = JSON.parse(src);
          allShipIds.forEach(id=>{ if(data[id]) get(id).value = data[id]; });
        }catch(e){}
      }
      function autosave(){
        if(!$('remember').checked) return;
        const data = {};
        allShipIds.forEach(id=>data[id]=val(id));
        localStorage.setItem('goonCheckoutDraft', JSON.stringify(data));
      }
      allShipIds.forEach(id=> get(id)?.addEventListener('input', autosave));

      // ---- Validation ----
      function clearErrors(){ reqIds.forEach(id=>get(id)?.classList.remove('error')); }
      function ensureShippingComplete(){
        clearErrors();
        let firstMissing = null;
        reqIds.forEach(id=>{
          if(!val(id)){
            const el = get(id);
            if(el){ el.classList.add('error'); if(!firstMissing) firstMissing = el; }
          }
        });
        if(firstMissing){ firstMissing.scrollIntoView({behavior:'smooth', block:'center'}); firstMissing.focus(); return false; }
        // basic format checks
        if(val('email') && !/.+@.+\..+/.test(val('email'))){ get('email').classList.add('error'); get('email').focus(); return false; }
        if(val('state') && val('state').length!==2){ get('state').classList.add('error'); get('state').focus(); return false; }
        if(val('zip') && !/^\d{5}(-\d{4})?$/.test(val('zip'))){ get('zip').classList.add('error'); get('zip').focus(); return false; }
        return true;
      }

      // ---- Payment method switching ----
      const pmRadios = document.querySelectorAll('input[name="pm"]');
      const containers = { card: $('pay-card'), paypal: $('pay-paypal'), venmo: $('pay-venmo'), apple: $('pay-apple'), google: $('pay-google') };
      function setActive(method){
        document.querySelectorAll('.pmethod').forEach(lbl=>lbl.classList.remove('active'));
        const lbl = document.querySelector(`.pmethod input[value="${method}"]`);
        if(lbl){ lbl.parentElement.classList.add('active'); }
        Object.entries(containers).forEach(([k,el])=>{ el.classList.toggle('hidden', k!==method); });
      }
      pmRadios.forEach(r=>r.addEventListener('change', e=>setActive(e.target.value)));

      // ---- Build order + redirect ----
      function buildOrder(paymentMethod){
        const taxBase = Math.max(0, subtotal - discount);
        const tax = +(taxBase * 0.07).toFixed(2);
        const grand = Math.max(0, taxBase + shippingCost + tax);
        const order = {
          id: 'GP-' + Math.random().toString(36).slice(2,8).toUpperCase(),
          placedAt: new Date().toISOString(),
          paymentMethod,
          customer: {
            first: val('first'), last: val('last'), email: val('email'), phone: val('phone'),
            address: val('address'), city: val('city'), state: val('state'), zip: val('zip'), country: val('country')||'US'
          },
          items: cart,
          totals: { subtotal, discount, shipping: shippingCost, tax, grand },
          shipping: { method: shipMethod },
          promo
        };
        localStorage.setItem('goonLastOrder', JSON.stringify(order));
        localStorage.removeItem('goonCart');
        if($('remember').checked){ autosave(); } else { localStorage.removeItem('goonCheckoutDraft'); }
        return order.id;
      }

      function paySuccess(method){
        const oid = buildOrder(method);
        window.location.href = 'secure-order.html#' + oid;
      }

      // ---- Card button state ----
      const btnCard = $('btn-card');
      const ccFields = ['cc-number','cc-exp','cc-name','cc-cvc'];
      function updateCardBtn(){
        const agree = $('agree').checked;
        const cardOk = ccFields.every(id=>val(id));
        btnCard.disabled = !(ensureShippingComplete() && cardOk && agree);
      }
      [...reqIds, ...ccFields, 'agree'].forEach(id=>get(id)?.addEventListener('input', updateCardBtn));
      setTimeout(updateCardBtn, 300); // autofill recheck

      // ---- Express pay handlers ----
      $('btn-paypal').addEventListener('click', ()=>{ if(ensureShippingComplete()) paySuccess('paypal'); });
      $('btn-venmo').addEventListener('click', ()=>{ if(ensureShippingComplete()) paySuccess('venmo'); });
      $('btn-apple').addEventListener('click', ()=>{ if(ensureShippingComplete()) paySuccess('apple'); });
      $('btn-google').addEventListener('click', ()=>{ if(ensureShippingComplete()) paySuccess('google'); });
      btnCard.addEventListener('click', ()=>{ if(ensureShippingComplete()) paySuccess('card'); });

      // ---- init ----
      readCart();
      loadDraft();
      applyPromoCode('');
      setActive('card');
      refreshShippingUI();
      renderTotals();
      updateCardBtn();
    });
  </script>
</body>
</html>
